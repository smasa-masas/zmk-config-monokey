#include <zephyr/dt-bindings/input/input-event-codes.h>
#include "monokey.dtsi"

&spi0 {
    status = "okay";

    trackball: trackball@0 {
        status = "okay";
        compatible = "pixart,pmw3610";
        reg = <0>;
        spi-max-frequency = <2000000>;
        motion-gpios = <&gpio0 2 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;

        /*
         * ★ ここが最重要 ★
         * PMW3610 が 90° 回転実装されている前提
         *
         * 物理上 → 上 : カーソル上
         * 物理右 → カーソル右
         */
        zephyr,axis-x = <INPUT_REL_X>;
        zephyr,axis-y = <INPUT_REL_Y>;

        /* 上下だけが逆だったため、ここでYを反転 */
        zephyr,invert-y;

        res-cpi = <800>;
    };
};

#include <input/processors.dtsi>

/ {
    trackball_listener {
        compatible = "zmk,input-listener";
        device = <&trackball>;

        /* 感度調整のみ（符号反転はしない） */
        default-layer {
            layers = <0>;
            input-processors = <&zip_xy_scaler (1) (1)>;
        };

        cpi-low {
            layers = <2>;
            input-processors = <&zip_xy_scaler (1) (2)>;
        };

        cpi-high {
            layers = <3>;
            input-processors = <&zip_xy_scaler (2) (2)>;
        };

        scroll-mode {
            layers = <5>;
            input-processors = <&zip_xy_to_scroll_mapper>;
        };
    };
};
